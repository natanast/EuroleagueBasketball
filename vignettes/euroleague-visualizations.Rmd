---
title: "Example visualizations using the euroleague data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{euroleague-visualizations}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Intro

This page demonstrates quick exploratory charts you can build with the `euroleague_basketball` dataset.

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Import libraries

```{r setup}
library(EuroleagueBasketball)
library(ggplot2)
library(ggrepel)
library(stringr)
library(data.table)
library(ggtext)
library(extrafont)

```

## Peek at the data

```{r}

head(EuroleagueBasketball::euroleague_basketball[, .(Team, Country, `Home city`, Arena, Capacity,
                                                     FinalFour_Appearances, Titles_Won)])


```

## Titles vs Final Four Appearances

```{r plot_titles_vs_finalfour, echo=TRUE, fig.width=7, fig.height=5}

# Convert to data.table
dt <- as.data.table(euroleague_basketball)

# Convert columns to numeric
dt[, Titles_Won_num := as.numeric(Titles_Won)]
dt[, FinalFour_num := as.numeric(FinalFour_Appearances)]

labels <- dt[FinalFour_Appearances > 0]

# Plot
ggplot(dt, aes(x = Titles_Won_num, y = FinalFour_num)) +
    
    
    geom_point(color = "#295466", size = 3) +
    
    geom_text_repel(
        data = labels,
        aes(label = Team),
        size = 3
    ) +
    
    labs(
        title = "EuroLeague Titles vs Final Four Appearances",
        x = "Titles Won",
        y = "Final Four Appearances"
     ) +
    
    theme_minimal(base_family = "Candara") +
    
    theme(
        panel.grid.major = element_line(linewidth = 0.45, color = "grey85", lineend = "round"),
        panel.grid.minor = element_line(
            linewidth = 0.35, 
            color = "grey85", 
            linetype = "dashed", 
            lineend = "round"
        ),
        
        plot.margin = margin(20, 20, 20, 20),
        
        plot.background = element_rect(fill = "grey93", color = NA)
    )
    


```

*Takeaway:* Teams with many Final Four appearances arenâ€™t always those with the most titles. For example, some teams are consistent contenders but rarely convert appearances into championships.

## EuroLeague Arena Capacities

```{r second_plot, echo=TRUE, fig.width=10, fig.height=8}

# Convert to data.table
df <- as.data.table(euroleague_basketball)

df1 <- df[, .(Team, Arena, Capacity)]

caps_list <- df1$Capacity |>
    str_extract_all("\\d{1,3}(?:[.,]\\d{3})*")

df_plot <- data.table(
    Team     = rep(df1$Team, caps_list |> lengths()),
    Capacity = caps_list |> unlist()
)

df_plot[, Capacity_num := Capacity |> str_remove_all("[^0-9]") |> as.integer()]


# sort rows by numeric capacity (ascending)
setorder(df_plot, Capacity_num)

# lock that order into the y-axis (and colors if you map by Team)
df_plot[, Team := factor(Team, levels = unique(Team))]


col = c('#033342', '#124150', '#224f5e', '#325d6d', 
        '#426b7b', '#527a8b', '#62899a', '#7199aa', 
        '#81a8ba', '#91b8cb', '#ffa49c', '#e88982', '#db7771', 
        '#cd6560', '#bf5350', '#ae4343', '#9d3336', 
        '#8c2229', '#7a121c', '#67000e')

# plot -------

ggplot(df_plot, aes(x = Capacity_num, y = Team)) +

    geom_segment(
        aes(x = 0, xend = Capacity_num, y = Team, yend = Team, color = Team),
        linewidth = .75
    ) +

    geom_point(
        aes(color = Team),
        shape = 21,
        stroke = .95,
        size = 4.5,
        fill = "grey95",
    ) +

    geom_text(
        aes(label = scales::comma(Capacity_num)),
        nudge_x = 1250,
        size = 2,
        vjust = -0.35
    ) +

    scale_color_manual(
        values = rev(col)
    ) +

     scale_x_continuous(labels = scales::comma) +
    
    labs(
        title = "Home Arena Capacities of EuroLeague Teams",
        x = "Capacity",
        y = NULL,
        fill = "Team"
    ) +

    theme_minimal(base_family = "Candara") +

    theme(

        axis.title.y = element_blank(),

        axis.title.x = element_text(size = 10),

        axis.text = element_text(size = 8),

        legend.position = "none",

        panel.grid.major = element_line(color = "grey75", linetype = "dashed", lineend = "round"),
        panel.grid.minor = element_blank(),

        plot.title = element_markdown(size = 14, face = "bold", hjust = 0.5, margin = margin(t = 2, b = 15)),

        plot.margin = margin(20, 20, 20, 20),

        plot.background = element_rect(fill = "#e4e4e3", color = NA)

    )

```
